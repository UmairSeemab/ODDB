<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Donut Chart: Ocular Diseases by Inheritance</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- Site Icons -->
  <link rel="shortcut icon" href="images/fevicon.ico.png" type="image/x-icon" />
  <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <!-- Site CSS -->
  <link rel="stylesheet" href="style.css">
  <!-- ALL VERSION CSS -->
  <link rel="stylesheet" href="css/versions.css">
  <!-- Responsive CSS -->
  <link rel="stylesheet" href="css/responsive.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/custom.css">
  <!-- Modernizer for Portfolio -->
  <script src="js/modernizer.js"></script>
  <!-- [if lt IE 9] -->
  <style>
    body {
      font-family: Arial, sans-serif;
      /*padding: 20px;*/
    }

    table {
      border-collapse: collapse;
      margin-top: 20px;
      width: 100%;
    }

    th,
    td {
      border: 1px solid #666;
      padding: 8px 12px;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
    }

    .controls {
      margin: 15px 0;
    }

    .button {
      padding: 8px 16px;
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
    }

    .button:hover {
      background-color: #0056b3;
    }

    select {
      margin-left: 10px;
      font-size: 14px;
    }
  </style>
  <style>
    table {
      border-collapse: collapse;
      width: 80%;
      margin-top: 0px;
    }

    th,
    td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    td {
      color: #999;
    }

    th {
      background: #fff;
      color: #157fda
    }
  </style>
</head>

<body>
<div class="container">
  <div class="contact-container">
    <h2 class="text-center" style="color:#157fda;">Contact Us</h2>
    <form id="contactForm">
      <input type="text" id="name" class="form-control" placeholder="Your Name" required>
      <input type="email" id="email" class="form-control" placeholder="Your Email" required>
      <textarea id="message" rows="5" class="form-control" placeholder="Your Message" required></textarea>

      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" id="humanCheck">
        <label class="form-check-label" for="humanCheck">I am human</label>
      </div>

      <button type="submit" id="sendBtn" class="btn btn-primary btn-block" disabled>Send Message</button>
      <div id="successMsg">Message sent successfully.</div>
      <div id="errorMsg">Failed to send message. Try again later.</div>
    </form>
  </div>
</div>

<script>
  // Initialize EmailJS
  emailjs.init('eaZJ3m1RyS3HEHXXv'); // replace with your EmailJS Public Key

  document.getElementById("humanCheck").addEventListener("change", function() {
    document.getElementById("sendBtn").disabled = !this.checked;
  });

  document.getElementById("contactForm").addEventListener("submit", function(e) {
    e.preventDefault();

    emailjs.send("service_jcz7wj8", "template_lz07abk", {
      from_name: document.getElementById("name").value,
      from_email: document.getElementById("email").value,
      message: document.getElementById("message").value
    }).then(() => {
      document.getElementById("successMsg").style.display = "block";
      document.getElementById("errorMsg").style.display = "none";
      e.target.reset();
      document.getElementById("sendBtn").disabled = true;
    }, (error) => {
      console.error("EmailJS Error:", error);
      document.getElementById("errorMsg").style.display = "block";
    });
  });
</script>
  <footer id="footer" class="footer-area wow fadeIn">
      <div class="container">
         <div class="row">
            <div class="col-md-4">
               <div class="logo padding">
                  <a href=""><img src="images/logo1.png" alt=""></a>
                  <p>A database for Ocular Diseases.</p>
               </div>
            </div>
            <div class="col-md-4">
               <div class="footer-info padding">
                  <h3>CONTACT US</h3>
                  <p><i class="fa fa-map-marker" aria-hidden="true"></i> UEF, Kuopio, Finland</p>
                  <p><i class="fa fa-paper-plane" aria-hidden="true"></i> u.seemab@gmail.com</p>
                  <p><i class="fa fa-phone" aria-hidden="true"></i> (+358) 123 456</p>
               </div>
            </div>
            <div class="col-md-4">
               <div id="statsContainer">
                  <h1 style="text-align:left;font-weight:600;">
                     Visitors count: <span id="visitorCount">0</span>
                  </h1>

                  <div style="max-height:128px; overflow-y:auto; border:1px solid #ccc;">
                     <table border="1" cellspacing="0" cellpadding="8"
                        style="width:100%; text-align:center; border-collapse:collapse;">
                        <tbody id="statsTable"></tbody>
                     </table>
                  </div>
               </div>

               <script type="module">
                  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
                  import {
                     getFirestore,
                     collection,
                     addDoc,
                     getDocs,
                     query,
                     where
                  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

                  const firebaseConfig = {
                     apiKey: "AIzaSyA5VIAFJB1buNlmwNbbxyEpJmQdlVH5_84",
                     authDomain: "daring-acumen-427809-i1.firebaseapp.com",
                     projectId: "daring-acumen-427809-i1",
                     storageBucket: "daring-acumen-427809-i1.firebasestorage.app",
                     messagingSenderId: "390763490659",
                     appId: "1:390763490659:web:6bb73c6ed513927cf03756",
                     measurementId: "G-XYH6N9K123"
                  };

                  const app = initializeApp(firebaseConfig);
                  const db = getFirestore(app);

                  async function logVisitor() {
                     try {
                        const res = await fetch("https://get.geojs.io/v1/ip/geo.json");
                        const data = await res.json();

                        const ip = data.ip || "Unknown IP";

                        let location = "Unknown Location";
                        if (data.city && data.country) {
                           location = `${data.city}, ${data.country}`;
                        } else if (data.country) {
                           location = data.country;
                        } else if (data.organization_name) {
                           location = data.organization_name;
                        }

                        const now = new Date();

                        const visitDate = now.toLocaleDateString("en-US", {
                           timeZone: "America/New_York"
                        });

                        const visitorsRef = collection(db, "visitors");
                        const q = query(visitorsRef, where("ip", "==", ip), where("date", "==", visitDate));
                        const existing = await getDocs(q);

                        if (!existing.empty) {
                           console.log("IP already visited today, skipping add:", ip);
                           renderTable();
                           return;
                        }

                        await addDoc(visitorsRef, {
                           ip,
                           location,
                           date: visitDate,
                           time: now.toLocaleString("en-US", {
                              timeZone: "America/New_York",
                              year: "numeric",
                              month: "2-digit",
                              day: "2-digit",
                              hour: "2-digit",
                              minute: "2-digit",
                              second: "2-digit",
                              hour12: false
                           })
                        });

                        console.log("Visitor saved to Firebase!");
                        renderTable();
                     } catch (err) {
                        console.error("Error logging visitor:", err);
                     }
                  }

                  async function renderTable() {
                     const tbody = document.getElementById("statsTable");
                     const visitorCount = document.getElementById("visitorCount");

                     tbody.innerHTML = `<tr><td colspan="2">Loading...</td></tr>`;

                     try {
                        const snapshot = await getDocs(collection(db, "visitors"));
                        let logs = snapshot.docs.map(doc => doc.data());

                        // ðŸ”¹ Convert string "time" â†’ Date object, then sort
                        logs.sort((a, b) => {
                           const dateA = new Date(a.time);
                           const dateB = new Date(b.time);
                           return dateB - dateA; // newest first
                        });

                        visitorCount.textContent = logs.length;
                        tbody.innerHTML = "";

                        if (!logs.length) {
                           tbody.innerHTML = `<tr><td colspan="2">No visitors logged yet</td></tr>`;
                           return;
                        }

                        // Show latest 15 visitors
                        logs.slice(0, 15).forEach(log => {
                           const tr = document.createElement("tr");
                           tr.innerHTML = `<td>${log.location}</td><td>${log.time}</td>`;
                           tbody.appendChild(tr);
                        });
                     } catch (err) {
                        tbody.innerHTML = `<tr><td colspan="2">Error loading logs: ${err.message}</td></tr>`;
                     }
                  }

                  document.addEventListener("DOMContentLoaded", logVisitor);
               </script>
            </div>
         </div>
      </div>
   </footer>
   <div class="copyright-area wow fadeIn">
      <div class="container">
         <div class="row">
            <div class="col-md-8">
               <div class="footer-text">
                  <p>Â© LRL Group. All Rights Reserved.</p>
               </div>
            </div>
            <div class="col-md-4">
               <div class="social">
                  <ul class="social-links">
                     <li><a href=""><i class="fa fa-rss"></i></a></li>
                     <li><a href=""><i class="fa fa-facebook"></i></a></li>
                     <li><a href=""><i class="fa fa-twitter"></i></a></li>
                     <li><a href=""><i class="fa fa-google-plus"></i></a></li>
                     <li><a href=""><i class="fa fa-youtube"></i></a></li>
                     <li><a href=""><i class="fa fa-pinterest"></i></a></li>
                  </ul>
               </div>
            </div>
         </div>
      </div>
   </div>
   <!-- end copyrights -->
   <a href="#home" data-scroll class="dmtop global-radius"><i class="fa fa-angle-up"></i></a>
   <!-- all js files -->
   <script src="js/all.js"></script>
   <!-- all plugins -->
   <script src="js/custom.js"></script>
   <!-- map -->
   <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCNUPWkb4Cjd7Wxo-T4uoUldFjoiUA1fJc&callback=myMap"></script>
</body>


</html>
